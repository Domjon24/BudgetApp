"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _index=_interopRequireDefault(require("../../../../fusioncharts/core/index"));var _stackedbar2d=_interopRequireDefault(require("../../../../fusioncharts/viz/stackedbar2d"));var _ignoreCaseExt=_interopRequireDefault(require("../../../../../packages/fc-features/src/ignore-case-ext"));var _utitilies=require("../../../../../dev-tests/viz/utitilies");var _stack=_interopRequireDefault(require("../../../../../dev-tests/viz/stack"));var _lib=require("@fusioncharts/core/src/lib");_index.default.addDep(_stackedbar2d.default);_index.default.addDep(_ignoreCaseExt.default);describe("StackedBar2D label",(function(){var chart,dataSource={chart:{theme:"fusion",caption:"Product-wise quarterly revenue in current year",subCaption:"Harry's SuperMart",xAxisname:"Quarter",yAxisName:"Revenue (In USD)",numberPrefix:"$",paletteColors:"#0075c2,#1aaf5d",bgColor:"#ffffff",borderAlpha:"20",showCanvasBorder:"0",usePlotGradientColor:"0",plotBorderAlpha:"10",legendBorderAlpha:"0",legendShadow:"0",valueFontColor:"#ffffff",showXAxisLine:"1",xAxisLineColor:"#999999",divlineColor:"#999999",divLineIsDashed:"1",showAlternateVGridColor:"0",subcaptionFontBold:"0",subcaptionFontSize:"14",showHoverEffect:"1",showValues:"1"},categories:[{category:[{label:"Q1"},{label:"Q2"},{label:"Q3"},{label:"Q4"}]}],dataset:[{seriesname:"Food Products",data:[{value:"11000"},{value:"135000"},{value:"123500"},{value:"145000"}]},{seriesname:"Non-Food Products",data:[{value:"131400"},{value:"154800"},{value:"98300"},{value:"131800"}]},{seriesname:"Oil-Food Products",data:[{value:"131400"},{value:"154800"},{value:"98300"},{value:"131800"}]}]};beforeEach((function(){chart=(0,_utitilies.setup)(_index.default,{type:"stackedbar2d",id:"id1",renderAt:_utitilies.CONTAINER_ID,width:"600",height:"350",dataFormat:"json",dataSource:dataSource})}));afterEach((function(){chart&&!chart.disposed&&chart.dispose()}));it("Hide the label on low space",(function(done){chart.addEventListener("renderComplete",(function(e){var chartApi=chart.apiInstance,legendsGroup=chartApi.getChildren("legend")[0].getChildren()["legendItem"],foundOverflowedLabel=false;for(var k=0;k<legendsGroup.length;k++){var legends=legendsGroup[k],dataSet=legends.linkedItems.owner,chartA=dataSet.getFromEnv("chart"),conf=dataSet.config,JSONData=conf.JSONData,setDataArr=JSONData.data,categories=chartA.config.categories,catLen=categories&&categories.length,dataSetLen=setDataArr&&setDataArr.length,dataStore=dataSet.getData(),SmartLabel=chartA.getFromEnv("smartLabel"),dataObj=void 0,numberFormatter=chartA.getFromEnv("number-formatter"),i=void 0,j=void 0,setData=void 0,graphic=void 0,setValue=void 0,skipInfo=dataSet.getSkippingInfo&&dataSet.getSkippingInfo(),skippingApplied=skipInfo&&skipInfo.skippingApplied,plotDrawArray=skipInfo&&skipInfo.labelDraw||[],plotDrawArrayLength=plotDrawArray.length,startIndex=(0,_lib.pluckNumber)(conf.scrollMinValForLabel,0),endIndex=(0,_lib.pluckNumber)(conf.scrollMaxValForLabel,skippingApplied?plotDrawArrayLength:catLen<dataSetLen?catLen:dataSetLen),notParticularLabeDraw=plotDrawArrayLength===Math.abs(endIndex-(startIndex+1)),config=void 0;for(j=startIndex;j<endIndex;j++){var _dataObj,_SmartLabel$getOriSiz;i=skippingApplied&&notParticularLabeDraw?plotDrawArray[j]:j;dataObj=dataStore[i];config=dataObj&&dataObj.config;setValue=config&&config.setValue;if(dataObj===undefined||setValue===undefined||setValue===null||config.labelSkip===true){continue}graphic=dataObj.graphics;if(!graphic){continue}setData=setDataArr[i];setValue=numberFormatter.getCleanValue(setData.value);if(((_dataObj=dataObj)==null?void 0:_dataObj._width)<((_SmartLabel$getOriSiz=SmartLabel.getOriSize(setValue))==null?void 0:_SmartLabel$getOriSiz.width)&&config.showValue!==0){foundOverflowedLabel=true}}}expect(foundOverflowedLabel).toBe(false);done()}));chart.render()}))}));