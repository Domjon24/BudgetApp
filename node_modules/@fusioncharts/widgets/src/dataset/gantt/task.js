"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=exports.hideFn=exports.extractLabelStyle=exports.checkInvalidValue=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _column=_interopRequireDefault(require("@fusioncharts/charts/src/dataset/column"));var _lib=require("@fusioncharts/core/src/lib");var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _task=_interopRequireDefault(require("./task.animation"));var _schedular=require("@fusioncharts/core/src/schedular");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))}keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}var UNDEF;function checkDateFormat(dateString){var dateFormat=/^(0?[1-9]|1[0-2])\/(0?[1-9]|[12][0-9]|3[01])\/\d{4} (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/;if(dateFormat.test(dateString)){return true}return false}var BLANK="",MINIMUM_TASKBAR_WIDTH=3,BOLD="bold",ITALIC="italic",NORMAL="normal",PROCESS="PROCESS_",ROLLOVER="DataPlotRollOver",ROLLOUT="DataPlotRollOut",DATAPLOTDRAGSTART="dataplotdragstart",DATAPLOTDRAGMOVE="dataplotdragmove",EVENTARGS=_lib.preDefStr.EVENTARGS,CANVASLEFTPADDING=1.5,align={left:"start",right:"end",center:"middle"},xAlign={left:0,right:1,center:.5,undefined:.5},alignGutter={left:5,right:-5,center:0,undefined:0},stylePropValues={fontWeight:[NORMAL,BOLD],fontStyle:[NORMAL,ITALIC]},hideFn=function hideFn(){this.hide()},defined=function defined(obj){return obj!==UNDEF&&obj!==null},extractLabelStyle=function extractLabelStyle(styleObj){var style,prop;for(prop in styleObj){if(styleObj[prop]!==UNDEF){style=style||{};switch(prop){case"fontWeight":case"fontStyle":style[prop]=stylePropValues[prop][styleObj[prop]];break;default:style[prop]=styleObj[prop]}}}return style},isPercent=function isPercent(str){return/%/g.test(str)},checkInvalidValue=function checkInvalidValue(){var i=0,ii=arguments.length,allValuesValid=false,val;for(i=0;i<ii;i++){val=arguments[i];if(isNaN(val)){return false}allValuesValid=true}return allValuesValid};exports.checkInvalidValue=checkInvalidValue;exports.extractLabelStyle=extractLabelStyle;exports.hideFn=hideFn;(0,_dependencyManager.addDep)({name:"taskAnimation",type:"animationRule",extension:_task.default});var Task=function(_Column){(0,_inheritsLoose2.default)(Task,_Column);function Task(){var _this;_this=_Column.call(this)||this;_this.components={};return _this}var _proto=Task.prototype;_proto.getName=function getName(){return"task"};_proto.__setDefaultConfig=function __setDefaultConfig(){_Column.prototype.__setDefaultConfig.call(this);var config=this.config;config.showpercentlabel=UNDEF;config.showlabels=UNDEF;config.showborder=1;config.borderthickness=1;config.font=_lib.BLANKSTRING;config.fontcolor=_lib.BLANKSTRING;config.fontsize=_lib.BLANKSTRING;config.color=_lib.BLANKSTRING;config.alpha=_lib.HUNDREDSTRING;config.angle=270;config.slackfillcolor=UNDEF;config.borderalpha=_lib.HUNDREDSTRING;config.hoverfillcolor=_lib.BLANKSTRING;config.slackhoverfillalpha=_lib.HUNDREDSTRING;config.showstartdate=UNDEF;config.showenddate=UNDEF};_proto.configureAttributes=function configureAttributes(){var dataset=this,jsonData=dataset.getFromEnv("dataSource"),userConfig=(0,_lib.extend2)({},jsonData.tasks&&jsonData.tasks.length?jsonData.tasks[0]:jsonData.tasks||{});(0,_lib.parseConfiguration)(userConfig,dataset.config,dataset.getFromEnv("chart").config,{task:true});if(!dataset.components){dataset.components={}}dataset.config.hoverfillalpha=(0,_lib.pluckNumber)(userConfig.hoverfillalpha,dataset.getFromEnv("chart").config.taskhoverfillalpha,_lib.HUNDREDSTRING);dataset._setConfigure();dataset.setState("dirty",true)};_proto._setConfigure=function _setConfigure(newDataset){var dataset=this,datasetConfig=dataset.config,chart=dataset.getFromEnv("chart"),yAxis=chart.getChildren("yAxis")[0],axisConfig=yAxis.config,jsonData=dataset.getFromEnv("dataSource"),chartAttrs=jsonData.chart,JSONData=jsonData.tasks&&jsonData.tasks.length?jsonData.tasks[0]:jsonData.tasks||{},setDataArr=newDataset||JSONData.length?JSONData:JSONData.task,setDataLen=setDataArr&&setDataArr.length,colorM=dataset.getFromEnv("color-manager"),chartConfig=chart.config,numberFormatter=dataset.getFromEnv("number-formatter"),taskMix=chartConfig.taskbarfillmix,taskRatio=chartConfig.taskbarfillratio,showSlackAsFill=chartConfig.showslackasfill,dataStore=dataset.components.data,percentComplete,eDate,sDate,i,processMap=axisConfig.processes.processMap,processes=axisConfig.processes.process.process,processName,arrColor,arrAlpha,arrRatio,dataLabel,dInt=chartConfig.dateintooltip,dataObj,taskObj,alignVal={right:"right",left:"left",undefined:"center",center:"center"},id,tAlpha,tBorderAlpha,tBorderColor,label,color,fillAngle,showPercentLabel,tasksMap=chart.components.tasksMap={},inCanStyle=chartConfig.style.inCanvasStyle,toolText,slHovColor,slColor,tColorObj,tHovColor,tHovBorderColor,taskId,dataConfig,showtooltip=(0,_lib.pluckNumber)(chartAttrs.showtooltip,1),dataLabelStyle=chartConfig.dataLabelStyle,datasetLabelStyle,setLabelStyle;if(!dataStore){dataStore=dataset.components.data=[]}datasetConfig.showlabels=(0,_lib.pluck)(JSONData.showlabels,JSONData.showlabels,JSONData.showname,chartAttrs.showtasklabels,chartAttrs.showtasknames,0);datasetConfig.showTextOutline=(0,_lib.pluckNumber)(chartAttrs.textoutline,0);datasetConfig.allowDrag=(0,_lib.pluckNumber)(chartAttrs.allowdrag,0);datasetLabelStyle=datasetConfig.labelStyle=extractLabelStyle({fontSize:datasetConfig.fontSize,fontFamily:datasetConfig.font});(0,_lib.setLineHeight)(datasetConfig.labelStyle);if(setDataLen){for(i=0;i<setDataLen;i+=1){taskObj=setDataArr[i];id=(0,_lib.pluck)(taskObj.processid);if(id&&typeof id==="string"){id=id.toLowerCase()}taskId=taskObj.id;percentComplete=taskObj.percentcomplete;tAlpha=(0,_lib.pluckNumber)(taskObj.alpha,datasetConfig.alpha);color=(0,_lib.pluck)(taskObj.color,datasetConfig.color,colorM.getColor("plotFillColor"));tBorderAlpha=(0,_lib.pluckNumber)(taskObj.borderalpha,datasetConfig.borderalpha,"100");tBorderColor=(0,_lib.pluck)(taskObj.bordercolor,datasetConfig.bordercolor,colorM.getColor("plotBorderColor"));label=(0,_lib.getFirstValue)((0,_lib.pluck)(taskObj.label,taskObj.name),BLANK);arrColor=colorM.parseColorMix(color,taskMix);arrAlpha=colorM.parseAlphaList(tAlpha.toString(),arrColor.length);arrRatio=colorM.parseRatioList(taskRatio,arrColor.length);fillAngle=(0,_lib.pluckNumber)(taskObj.angle,datasetConfig.angle);dataObj=dataStore[i]||(dataStore[i]={config:{}});dataConfig=dataObj.config;dataConfig.index=i;dataConfig.link=taskObj.link;dataConfig.processId=(0,_lib.pluck)(id,PROCESS+i);dataConfig.textColor=(0,_lib.getFirstColor)((0,_lib.pluck)(taskObj.fontcolor,datasetConfig.fontcolor,inCanStyle.color));dataConfig.textFont=(0,_lib.pluck)(taskObj.font,datasetConfig.font,inCanStyle.fontFamily);dataConfig.textFontSize=(0,_lib.pluckNumber)(taskObj.fontsize,datasetConfig.fontsizes,inCanStyle.fontSize);if(!taskObj.fontsize&&chartConfig.dataLabelStyle){taskObj.fontsize=chartConfig.dataLabelStyle.fontSize}dataConfig.style=extractLabelStyle({fontSize:taskObj.fontsize,fontFamily:taskObj.font});(0,_lib.setLineHeight)(dataConfig.style);setLabelStyle=dataConfig.style;dataConfig.lineHeight=(0,_lib.pluck)(setLabelStyle&&setLabelStyle.lineHeight,datasetLabelStyle&&datasetLabelStyle.lineHeight,dataLabelStyle&&dataLabelStyle.lineHeight);dataConfig.startMs=numberFormatter.getDateValue(taskObj.start).ms;dataConfig.endMs=numberFormatter.getDateValue(taskObj.end).ms;sDate=numberFormatter.getFormattedDate(dataConfig.startMs,chartAttrs.dateformat);eDate=numberFormatter.getFormattedDate(dataConfig.endMs,chartAttrs.dateformat);dataConfig.tAlpha=tAlpha;dataConfig.tBorderColor=tBorderColor;dataConfig.tBorderAlpha=tBorderAlpha;dataLabel=BLANK;dataConfig.percentComplete=percentComplete=Math.min((0,_lib.pluckNumber)(taskObj.percentcomplete,-1),100);dataConfig.labelAlign=alignVal[[(0,_lib.pluck)(taskObj.labelalign,chartConfig.tasklabelsalign).toLowerCase()]];dataConfig.showAsGroup=(0,_lib.pluckNumber)(taskObj.showasgroup,0);showPercentLabel=dataConfig.showPercentLabel=(0,_lib.pluckNumber)(taskObj.showpercentlabel,datasetConfig.showpercentlabel);if((0,_lib.pluckNumber)(taskObj.showlabel,taskObj.showname,datasetConfig.showlabels)){dataLabel=label}if(showPercentLabel&&percentComplete!==-1){dataLabel+=" "+percentComplete+"%"}dataConfig.percentComplete=percentComplete;tColorObj={FCcolor:{color:arrColor.join(),alpha:arrAlpha,ratio:arrRatio,angle:fillAngle}};slColor=colorM.parseColorMix((0,_lib.pluck)(taskObj.slackfillcolor,datasetConfig.slackfillcolor,chartConfig.slackfillcolor),taskMix);slColor=showSlackAsFill?{FCcolor:{color:slColor.join(),alpha:arrAlpha,ratio:arrRatio,angle:fillAngle}}:_lib.TRACKER_FILL;tHovColor={FCcolor:{color:colorM.parseColorMix((0,_lib.pluck)(taskObj.hoverfillcolor,datasetConfig.hoverfillcolor,chartConfig.taskhoverfillcolor,(0,_lib.getDarkColor)(color,80)),taskMix).join(),alpha:colorM.parseAlphaList((0,_lib.pluck)(taskObj.hoverfillalpha,datasetConfig.hoverfillalpha).toString(),arrColor.length),ratio:arrRatio,angle:fillAngle}};tHovBorderColor=(0,_lib.convertColor)((0,_lib.pluck)(taskObj.hoverbordercolor,datasetConfig.hoverbordercolor,(0,_lib.getDarkColor)(tBorderColor,80)),(0,_lib.pluck)(taskObj.hoverborderalpha,datasetConfig.hoverborderalpha,tBorderAlpha));slHovColor=showSlackAsFill?{FCcolor:{color:colorM.parseColorMix((0,_lib.getDarkColor)((0,_lib.pluck)(taskObj.slackhoverfillcolor,datasetConfig.slackhoverfillcolor,chartConfig.slackfillcolor),80),taskMix).join(),alpha:colorM.parseAlphaList((0,_lib.pluck)(taskObj.slackhoverfillalpha,datasetConfig.slackhoverfillalpha,"100").toString(),arrColor.length),ratio:arrRatio,angle:fillAngle}}:_lib.TRACKER_FILL;dataConfig.color=(0,_lib.toRaphaelColor)(tColorObj);dataConfig.rawTaskColor=color;dataConfig.rawTaskAlpha=tAlpha;dataConfig.slackColor=(0,_lib.toRaphaelColor)(slColor);dataConfig.hoverFillColor=(0,_lib.toRaphaelColor)(tHovColor);dataConfig.hoverBorderColor=tHovBorderColor;dataConfig.slackHoverColor=(0,_lib.toRaphaelColor)(slHovColor);dataConfig.showHoverEffect=(0,_lib.pluckNumber)(taskObj.showhovereffect,datasetConfig.showhovereffect,chartAttrs.showhovereffect,1);dataConfig.taskHeight=(0,_lib.pluck)(taskObj.height,"35%");dataConfig.topPadding=(0,_lib.pluck)(taskObj.toppadding,"35%");dataConfig.showPercentLabel=showPercentLabel;dataConfig.endDate=(0,_lib.pluckNumber)(taskObj.showenddate,datasetConfig.showenddate)?eDate:UNDEF;dataConfig._endDate=eDate;dataConfig.startDate=(0,_lib.pluckNumber)(taskObj.showstartdate,datasetConfig.showstartdate)?sDate:UNDEF;dataConfig._startDate=sDate;dataConfig.shadow={opacity:Math.max(tAlpha,tBorderAlpha)/100,inverted:true};dataConfig.id=id;dataConfig.taskId=taskId;dataConfig.borderColor=(0,_lib.convertColor)(tBorderColor,tBorderAlpha);dataConfig.borderThickness=(0,_lib.pluckNumber)(taskObj.showborder,datasetConfig.showborder)?(0,_lib.pluckNumber)(taskObj.borderthickness,datasetConfig.borderthickness):0;toolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(taskObj.tooltext,datasetConfig.hovertext,datasetConfig.plottooltext,chartAttrs.plottooltext),false));if(showtooltip){if(toolText!==UNDEF){if(processMap[id]){processName=processMap[id].catObj.label||processMap[id].catObj.name}else{processName=processes[i]&&(processes[i].label||processes[i].name)}toolText=(0,_lib.parseTooltext)(toolText,[3,28,29,30,31],{end:numberFormatter.getFormattedDate(dataConfig.endMs,chartAttrs.outputdateformat),start:numberFormatter.getFormattedDate(dataConfig.startMs,chartAttrs.outputdateformat),label:label,percentComplete:percentComplete!==-1?numberFormatter.percentValue(percentComplete):BLANK,processName:processName},datasetConfig)}else{toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?numberFormatter.getFormattedDate(dataConfig.startMs,chartAttrs.outputdateformat)+" - "+numberFormatter.getFormattedDate(dataConfig.endMs,chartAttrs.outputdateformat):BLANK)}}dataConfig.label=dataLabel;dataConfig.toolText=toolText;typeof taskId==="string"&&(taskId=taskId.toLowerCase());if(taskId!==UNDEF){tasksMap[taskId]=dataStore[i]}}}if((0,_lib.pluckNumber)(JSONData.visible,1)){dataset.setState("visible",true)}else{dataset.setState("visible",false)}};_proto._getParentToolTextOnDrag=function _getParentToolTextOnDrag(startMs,endMs,parentConfig){var _dataSource$tasks$,_dataSource$tasks;var element=this,data=element.data("drag-options"),dataset=data.dataset,dataSource=dataset.getFromEnv("dataSource"),chartAttr=dataSource.chart,task=Array.isArray(dataSource==null?void 0:dataSource.tasks)?dataSource==null?void 0:(_dataSource$tasks$=dataSource.tasks[0])==null?void 0:_dataSource$tasks$.task:dataSource==null?void 0:(_dataSource$tasks=dataSource.tasks)==null?void 0:_dataSource$tasks.task,index=parentConfig.index,taskObj=task[index],label=(0,_lib.getFirstValue)((0,_lib.pluck)(taskObj.label,taskObj.name),BLANK),chartConfig=dataset.getFromEnv("chartConfig"),toolText="",numberFormatter=dataset.getFromEnv("number-formatter"),dInt=chartConfig.dateintooltip;toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?numberFormatter.getFormattedDate(startMs,chartAttr.outputdateformat)+" - "+numberFormatter.getFormattedDate(endMs,chartAttr.outputdateformat):BLANK);return toolText};_proto._checkUpdatedTaskWidth=function _checkUpdatedTaskWidth(startMs,endMs){var element=this,data=element.data("drag-options"),dataset=data.dataset,chart=dataset.getFromEnv("chart"),xAxis=chart.getChildren("xAxis")[0],chartConfig=chart.config,viewPortConfig=chartConfig.viewPortConfig,x=viewPortConfig.x,scaleX=viewPortConfig.scaleX,xPos=xAxis.getPixel(startMs)+x*scaleX,endX=xAxis.getPixel(endMs)+x*scaleX,width=Math.round(endX-xPos);return MINIMUM_TASKBAR_WIDTH<width};_proto.dragStartWidthHandler=function dragStartWidthHandler(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset;dataset._dragStartWidthHandler.call(ele,event)};_proto._dragStartWidthHandler=function _dragStartWidthHandler(){var _dataSource$tasks$2,_dataSource$tasks2;var element=this,data=element.data("drag-options"),dataObj=data.dataObj,dataGraphics=dataObj.graphics,ele=dataGraphics.element,bBox=ele.getBBox(),config=dataObj.config,dataset=data.dataset,dataSource=dataset.getFromEnv("dataSource"),chartAttr=dataSource.chart,numberFormatter=dataset.getFromEnv("number-formatter"),chart=dataset.getFromEnv("chart"),task=Array.isArray(dataSource==null?void 0:dataSource.tasks)?dataSource==null?void 0:(_dataSource$tasks$2=dataSource.tasks[0])==null?void 0:_dataSource$tasks$2.task:dataSource==null?void 0:(_dataSource$tasks2=dataSource.tasks)==null?void 0:_dataSource$tasks2.task,index=config==null?void 0:config.index,taskObj=task[index],sourceEvent=DATAPLOTDRAGSTART,dragStart=config.dragStart||(config.dragStart={}),dragData=config.dragData||(config.dragData={}),eventArgs,taskbarElement=data.taskbarElement,direction=data.direction;data.tempStartMs=dataObj.startMs;data.tempEndMs=dataObj.endMs;dragStart.xPos=direction==="left"?config.xPos:config.xPos+taskbarElement.attrs.width;dragStart.x=config.xPos;dragStart.bBox=bBox;var dateFormat=checkDateFormat(taskObj.start);dragData.prevStartDate=numberFormatter.getFormattedDate(config.startMs,dateFormat?"mm/dd/yyyy hh:mn:ss":chartAttr.dateformat);dragData.prevEndDate=numberFormatter.getFormattedDate(config.endMs,dateFormat?"mm/dd/yyyy hh:mn:ss":chartAttr.dateformat);dragStart.origX=dragStart.lastDx||(dragStart.lastDx=0);eventArgs=ele.data(EVENTARGS);chart.fireChartInstanceEvent(sourceEvent,eventArgs)};_proto.dragMoveWidthHandler=function dragMoveWidthHandler(event,customData){var ele=this,data=ele.data("drag-options"),dataset=data.dataset,dx=customData[0],dy=customData[1],px=customData[2],py=customData[3];dataset._dragMoveWidthHandler.call(ele,dx,dy,px,py)};_proto._dragMoveWidthHandler=function _dragMoveWidthHandler(dxVal){var _dataSource$tasks$3,_dataSource$tasks3,_dataObj$config,_dataSource$connector;var element=this,dx=dxVal,i,canvasPadding=CANVASLEFTPADDING,data=element.data("drag-options"),dataObj=data.dataObj,taskbarElement=data.taskbarElement,direction=data.direction,dataset=data.dataset,datasetConfig=dataset.config,dataSource=dataset.getFromEnv("dataSource"),chartAttr=dataSource.chart,task=Array.isArray(dataSource==null?void 0:dataSource.tasks)?dataSource==null?void 0:(_dataSource$tasks$3=dataSource.tasks[0])==null?void 0:_dataSource$tasks$3.task:dataSource==null?void 0:(_dataSource$tasks3=dataSource.tasks)==null?void 0:_dataSource$tasks3.task,chart=dataset.getFromEnv("chart"),tasksMap=chart.components.tasksMap,numberFormatter=dataset.getFromEnv("number-formatter"),yAxis=dataset.getFromEnv("yAxis"),xAxis=dataset.getFromEnv("xAxis"),processMap=xAxis.config.processes.processMap,dataStore=dataset.components.data,ele=dataObj.graphics.element,config=dataObj.config,id=config.id,index=config==null?void 0:config.index,taskObj=task[index],label=(0,_lib.getFirstValue)((0,_lib.pluck)(taskObj.label,taskObj.name),BLANK),percentComplete=Math.min((0,_lib.pluckNumber)(taskObj.percentcomplete,-1),100),dragStart=config.dragStart,dragData=config.dragData,startX=dragStart.bBox.x+dx,endX=dragStart.bBox.x2+dx,chartConfig=dataset.getFromEnv("chartConfig"),canvasLeft=chartConfig.canvasLeft,toolText="",processName,canvasRight=yAxis.getPixel(chartConfig.scrollOptions.viewPortMax),dInt=chartConfig.dateintooltip,len,viewPortScale,setObj;var prevElement,dateFormat,nextElement,nextElConfig,nextElData;if(chartConfig.scrolltodate){viewPortScale=chartConfig.viewPortConfig.scaleX*chartConfig.viewPortConfig.x;canvasLeft=canvasLeft+viewPortScale;canvasRight=canvasRight+viewPortScale}var isTaskbarFitToWidth=Math.sign(canvasRight-canvasLeft-(dragStart.bBox.x2-dragStart.bBox.x))===-1;if(startX<canvasLeft&&!isTaskbarFitToWidth&&direction==="left"&&Math.sign(dxVal)===-1){dx+=canvasLeft+canvasPadding-startX}if(endX>canvasRight&&!isTaskbarFitToWidth&&direction==="right"&&Math.sign(dxVal)===1){dx-=endX-canvasRight}if(dx){ele.data("fire_click_event",0)}if(taskObj){toolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(taskObj.tooltext,datasetConfig.hovertext,datasetConfig.plottooltext,chartAttr.plottooltext),false));if(toolText!==UNDEF){if(id&&processMap[id]){processName=processMap[id].catObj.label||processMap[id].catObj.name}toolText=(0,_lib.parseTooltext)(toolText,[3,28,29,30,31],{end:numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.outputdateformat),start:numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.outputdateformat),label:label,percentComplete:percentComplete!==-1?numberFormatter.percentValue(percentComplete):BLANK,processName:processName},dataset.config)}else{toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.outputdateformat)+" - "+numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.outputdateformat):BLANK)}}dragStart.lastDx=dx;dateFormat=checkDateFormat(taskObj.start);if(direction==="left"){var _arrayOfAdjacentEleme,_nextElData,_nextElData$graphics,_arrayOfAdjacentEleme2,_arrayOfAdjacentEleme3,_task$nextElConfig$in;if(Math.sign(dxVal)===1&&dataObj.graphics.element.attrs.width===MINIMUM_TASKBAR_WIDTH)return;var arrayOfAdjacentElements=Object.values(tasksMap).filter((function(a){return a.graphics.element.attrs.y===taskbarElement.attrs.y})).sort((function(a,b){return a.graphics.element.attrs.x-b.graphics.element.attrs.x})),currentElIndex=arrayOfAdjacentElements==null?void 0:arrayOfAdjacentElements.findIndex((function(x,elIndex){var _task$elIndex;return x.graphics.element.attrs.y===taskbarElement.attrs.y&&x.graphics.element.attrs.x===taskbarElement.attrs.x&&((_task$elIndex=task[elIndex])==null?void 0:_task$elIndex.label)!=="Delay"}));nextElData=arrayOfAdjacentElements[currentElIndex+1];nextElConfig=(_arrayOfAdjacentEleme=arrayOfAdjacentElements[currentElIndex+1])==null?void 0:_arrayOfAdjacentEleme.config;nextElement=(_nextElData=nextElData)==null?void 0:(_nextElData$graphics=_nextElData.graphics)==null?void 0:_nextElData$graphics.element;prevElement=(_arrayOfAdjacentEleme2=arrayOfAdjacentElements[currentElIndex-1])==null?void 0:(_arrayOfAdjacentEleme3=_arrayOfAdjacentEleme2.graphics)==null?void 0:_arrayOfAdjacentEleme3.element;if(Math.sign(dxVal)===1&&nextElement&&nextElConfig&&((_task$nextElConfig$in=task[nextElConfig.index])==null?void 0:_task$nextElConfig$in.label)==="Delay"&&dataObj.graphics.element.attrs.width===nextElement.attrs.width+1)return;dataObj.config.startMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx);if(!chartAttr.allowtaskbaroverlap&&Math.sign(dxVal)===-1&&prevElement&&prevElement.attrs.x+prevElement.attrs.width>=element.attrs.x&&prevElement.attrs.y===element.attrs.y){dataObj.config.startMs=yAxis.getDraggedValue(prevElement.attrs.x+prevElement.attrs.width)}if(dragData.updatedStartDate!==numberFormatter.getFormattedDate(dataObj.config.startMs,dateFormat?"mm/dd/yyyy hh:mn:ss":chartAttr.dateformat)){var dragDataCopy=JSON.parse(JSON.stringify(dragData));chart.fireChartInstanceEvent(DATAPLOTDRAGMOVE,dragDataCopy)}dragData.updatedStartDate=numberFormatter.getFormattedDate(dataObj.config.startMs,dateFormat?"mm/dd/yyyy hh:mn:ss":chartAttr.dateformat);taskObj.start=dragData.updatedStartDate;dragData.updatedEndDate=dragData.prevEndDate;if((taskObj==null?void 0:taskObj.showasgroup)==="0"&&dataset._checkUpdatedTaskWidth.call(element,yAxis.getDraggedValue(dataObj.config.dragStart.xPos+dataObj.config.dragStart.lastDx-dataObj.graphics.element.attrs.width),dataObj.config.endMs,i)){if(taskObj.processid.includes(".1")){var matchingParentTask=dataset.components.data.find((function(t){return t.config.processId+".1"===taskObj.processid})),firstChildTask=tasksMap[matchingParentTask.config.processId+"-a"],secondChildTask=tasksMap[matchingParentTask.config.processId+"-b"];if(secondChildTask.config.startMs<firstChildTask.config.startMs){matchingParentTask.config._startDate=secondChildTask.config._startDate;matchingParentTask.config.startMs=secondChildTask.config.startMs}else{matchingParentTask.config._startDate=dragData.updatedStartDate;matchingParentTask.config.startMs=dataObj.config.startMs}if(secondChildTask.config.endMs<firstChildTask.config.endMs){matchingParentTask.config._endDate=dragData.updatedEndDate;matchingParentTask.config.endMs=dataObj.config.endMs}else{matchingParentTask.config._endDate=secondChildTask.config._endDate;matchingParentTask.config.endMs=secondChildTask.config.endMs}matchingParentTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,matchingParentTask.config.startMs,matchingParentTask.config.endMs,matchingParentTask.config);dataset.parsePlotAttributes(matchingParentTask,i-1)}if(taskObj.processid.includes(".2")){var _matchingParentTask=dataset.components.data.find((function(t){return t.config.processId+".2"===taskObj.processid})),_firstChildTask=tasksMap[_matchingParentTask.config.processId+"-a"],_secondChildTask=tasksMap[_matchingParentTask.config.processId+"-b"];if(_secondChildTask.config.endMs<_firstChildTask.config.endMs){_matchingParentTask.config._endDate=_firstChildTask.config._endDate;_matchingParentTask.config.endMs=_firstChildTask.config.endMs}else{_matchingParentTask.config._endDate=dragData.updatedEndDate;_matchingParentTask.config.endMs=dataObj.config.endMs}if(_secondChildTask.config.startMs<_firstChildTask.config.startMs){_matchingParentTask.config._startDate=dragData.updatedStartDate;_matchingParentTask.config.startMs=dataObj.config.startMs}else{_matchingParentTask.config._startDate=_firstChildTask.config._startDate;_matchingParentTask.config.startMs=_firstChildTask.config.startMs}_matchingParentTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,_matchingParentTask.config.startMs,_matchingParentTask.config.endMs,_matchingParentTask.config);dataset.parsePlotAttributes(_matchingParentTask,i-2)}}}else if(direction==="right"){var _arrayOfAdjacentEleme4,_nextElData2,_nextElData2$graphics,_task$nextElConfig$in2,_task$nextElConfig$in3;if(Math.sign(dxVal)===-1&&dataObj.graphics.element.attrs.width===MINIMUM_TASKBAR_WIDTH)return;var _arrayOfAdjacentElements=Object.values(tasksMap).filter((function(a){return a.graphics.element.attrs.y===taskbarElement.attrs.y})).sort((function(a,b){return a.graphics.element.attrs.x-b.graphics.element.attrs.x})),_currentElIndex=_arrayOfAdjacentElements==null?void 0:_arrayOfAdjacentElements.findIndex((function(x,elIndex){var _task$elIndex2;return x.graphics.element.attrs.y===taskbarElement.attrs.y&&x.graphics.element.attrs.x===taskbarElement.attrs.x&&((_task$elIndex2=task[elIndex])==null?void 0:_task$elIndex2.label)!=="Delay"}));nextElData=_arrayOfAdjacentElements[_currentElIndex+1];nextElConfig=(_arrayOfAdjacentEleme4=_arrayOfAdjacentElements[_currentElIndex+1])==null?void 0:_arrayOfAdjacentEleme4.config;nextElement=(_nextElData2=nextElData)==null?void 0:(_nextElData2$graphics=_nextElData2.graphics)==null?void 0:_nextElData2$graphics.element;if(Math.sign(dxVal)===-1&&nextElement&&nextElConfig&&((_task$nextElConfig$in2=task[nextElConfig.index])==null?void 0:_task$nextElConfig$in2.label)==="Delay"&&dataObj.graphics.element.attrs.width===nextElement.attrs.width+1)return;dataObj.config.endMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx);if(nextElement&&nextElConfig&&((_task$nextElConfig$in3=task[nextElConfig.index])==null?void 0:_task$nextElConfig$in3.label)==="Delay"){nextElConfig.endMs=dataObj.config.endMs;nextElConfig.startMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx-nextElement.attrs.width);dataset.parsePlotAttributes(nextElData,i+1)}else if(!chartAttr.allowtaskbaroverlap&&Math.sign(dxVal)===1&&nextElement&&element.attrs.x+element.attrs.width>=nextElement.attrs.x&&nextElement.attrs.y===element.attrs.y){dataObj.config.endMs=yAxis.getDraggedValue(nextElement.attrs.x)}if(dragData.updatedEndDate!==numberFormatter.getFormattedDate(dataObj.config.endMs,dateFormat?"mm/dd/yyyy hh:mn:ss":chartAttr.dateformat)){var _dragDataCopy=JSON.parse(JSON.stringify(dragData));chart.fireChartInstanceEvent(DATAPLOTDRAGMOVE,_dragDataCopy)}dragData.updatedStartDate=dragData.prevStartDate;dragData.updatedEndDate=numberFormatter.getFormattedDate(dataObj.config.endMs,dateFormat?"mm/dd/yyyy hh:mn:ss":chartAttr.dateformat);taskObj.end=dragData.updatedEndDate;if((taskObj==null?void 0:taskObj.showasgroup)==="0"&&dataset._checkUpdatedTaskWidth.call(element,yAxis.getDraggedValue(dataObj.config.dragStart.xPos+dataObj.config.dragStart.lastDx-dataObj.graphics.element.attrs.width),dataObj.config.endMs,i)){if(taskObj.processid.includes(".1")){var _matchingParentTask2=dataset.components.data.find((function(t){return t.config.processId+".1"===taskObj.processid})),_firstChildTask2=tasksMap[_matchingParentTask2.config.processId+"-a"],_secondChildTask2=tasksMap[_matchingParentTask2.config.processId+"-b"];if(_secondChildTask2.config.startMs<_firstChildTask2.config.startMs){_matchingParentTask2.config._startDate=_secondChildTask2.config._startDate;_matchingParentTask2.config.startMs=_secondChildTask2.config.startMs}else{_matchingParentTask2.config._startDate=dragData.updatedStartDate;_matchingParentTask2.config.startMs=dataObj.config.startMs}if(_secondChildTask2.config.endMs<_firstChildTask2.config.endMs){_matchingParentTask2.config._endDate=dragData.updatedEndDate;_matchingParentTask2.config.endMs=dataObj.config.endMs}else{_matchingParentTask2.config._endDate=_secondChildTask2.config._endDate;_matchingParentTask2.config.endMs=_secondChildTask2.config.endMs}_matchingParentTask2.config.toolText=dataset._getParentToolTextOnDrag.call(element,_matchingParentTask2.config.startMs,_matchingParentTask2.config.endMs,_matchingParentTask2.config);dataset.parsePlotAttributes(_matchingParentTask2,i-1)}if(taskObj.processid.includes(".2")){var _matchingParentTask3=dataset.components.data.find((function(t){return t.config.processId+".2"===taskObj.processid})),_firstChildTask3=tasksMap[_matchingParentTask3.config.processId+"-a"],_secondChildTask3=tasksMap[_matchingParentTask3.config.processId+"-b"];if(_secondChildTask3.config.endMs<_firstChildTask3.config.endMs){_matchingParentTask3.config._endDate=_firstChildTask3.config._endDate;_matchingParentTask3.config.endMs=_firstChildTask3.config.endMs}else{_matchingParentTask3.config._endDate=dragData.updatedEndDate;_matchingParentTask3.config.endMs=dataObj.config.endMs}if(_secondChildTask3.config.startMs<_firstChildTask3.config.startMs){_matchingParentTask3.config._startDate=dragData.updatedStartDate;_matchingParentTask3.config.startMs=dataObj.config.startMs}else{_matchingParentTask3.config._startDate=_firstChildTask3.config._startDate;_matchingParentTask3.config.startMs=_firstChildTask3.config.startMs}_matchingParentTask3.config.toolText=dataset._getParentToolTextOnDrag.call(element,_matchingParentTask3.config.startMs,_matchingParentTask3.config.endMs,_matchingParentTask3.config);dataset.parsePlotAttributes(_matchingParentTask3,i-2)}}}dataObj.config.toolText=toolText;dragData.index=dataObj==null?void 0:(_dataObj$config=dataObj.config)==null?void 0:_dataObj$config.index;dragData.id=dataObj==null?void 0:dataObj.config.taskId;for(i=0,len=dataStore.length;i<len;i++){setObj=dataStore[i];if(dataObj.config.index===setObj.config.index){break}}if(!dataset._checkUpdatedTaskWidth.call(element,dataObj.config.startMs,dataObj.config.endMs,dataObj.config.endMs,i))return;data.tempStartMs=dataObj.config.startMs;data.tempEndMs=dataObj.config.endMs;if(((_dataSource$connector=dataSource.connectors)==null?void 0:_dataSource$connector.length)>0){task[index]=_objectSpread(_objectSpread({},task[index]),{},{start:numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.dateformat),end:numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.dateformat)});dataSource.tasks=[_objectSpread(_objectSpread({},dataSource.tasks[0]),{},{task:task})];if(dataset._linkedParent.getChildren().connector){dataset._linkedParent.getChildren().connector[0]._state.dragged=true;dataset._linkedParent.getChildren().connector[0].draw()}}dataset.parsePlotAttributes(dataObj,i);dataset&&dataset.draw();if(dataset._linkedParent.getChildren().connector){dataset._linkedParent.getChildren().connector[0]._state.dragged=false}};_proto.dragStart=function dragStart(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset,chart=dataset.getFromEnv("chart"),tasksMap=chart.components.tasksMap;dataset._dragStart.call(ele,event);var arrayOfAdjacentElements=Object.values(tasksMap).filter((function(a){return a.graphics.element.attrs.y===ele.attrs.y})).sort((function(a,b){return a.graphics.element.attrs.x-b.graphics.element.attrs.x}));ele.data("arrayOfAdjacentElements",arrayOfAdjacentElements)};_proto._dragStart=function _dragStart(){var element=this,data=element.data("drag-options"),dataObj=data.dataObj,dataGraphics=dataObj.graphics,ele=dataGraphics.element,bBox=ele.getBBox(),config=dataObj.config,dataset=data.dataset,dataSource=dataset.getFromEnv("dataSource"),chartAttr=dataSource.chart,numberFormatter=dataset.getFromEnv("number-formatter"),chart=dataset.getFromEnv("chart"),sourceEvent=DATAPLOTDRAGSTART,dragStart=config.dragStart||(config.dragStart={}),dragData=config.dragData||(config.dragData={}),eventArgs;dragStart.xPos=config.xPos;dragStart.x=config.xPos;dragStart.bBox=bBox;dragData.prevStartDate=numberFormatter.getFormattedDate(config.startMs,chartAttr.dateformat);dragData.prevEndDate=numberFormatter.getFormattedDate(config.endMs,chartAttr.dateformat);dragStart.origX=dragStart.lastDx||(dragStart.lastDx=0);eventArgs=ele.data(EVENTARGS);chart.fireChartInstanceEvent(sourceEvent,eventArgs)};_proto.dragMove=function dragMove(event,customData){var ele=this,data=ele.data("drag-options"),dataset=data.dataset,dataSource=dataset.getFromEnv("dataSource"),chartAttr=dataSource.chart,arrayOfAdjacentElements=ele.data("arrayOfAdjacentElements"),dx=customData[0],dy=customData[1],px=customData[2],py=customData[3];function getAdjacentEl(){return _getAdjacentEl.apply(this,arguments)}function _getAdjacentEl(){_getAdjacentEl=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee(){var _arrayOfAdjacentEleme5,_arrayOfAdjacentEleme6,_arrayOfAdjacentEleme7,_arrayOfAdjacentEleme8;var prev,nextEl,currentElIndex,_ele$prev,_ele$prev$prev,_ele$next,_ele$next$next;return _regenerator.default.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:currentElIndex=arrayOfAdjacentElements==null?void 0:arrayOfAdjacentElements.findIndex((function(x){return x.graphics.element.attrs.y===ele.attrs.y&&x.graphics.element.attrs.x===ele.attrs.x}));prev=(_arrayOfAdjacentEleme5=arrayOfAdjacentElements[currentElIndex-1])==null?void 0:(_arrayOfAdjacentEleme6=_arrayOfAdjacentEleme5.graphics)==null?void 0:_arrayOfAdjacentEleme6.element;if(arrayOfAdjacentElements.length===0&&!prev){prev=ele==null?void 0:(_ele$prev=ele.prev)==null?void 0:(_ele$prev$prev=_ele$prev.prev)==null?void 0:_ele$prev$prev.prev}nextEl=(_arrayOfAdjacentEleme7=arrayOfAdjacentElements[currentElIndex+1])==null?void 0:(_arrayOfAdjacentEleme8=_arrayOfAdjacentEleme7.graphics)==null?void 0:_arrayOfAdjacentEleme8.element;if(arrayOfAdjacentElements.length===0&&!nextEl){nextEl=ele==null?void 0:(_ele$next=ele.next)==null?void 0:(_ele$next$next=_ele$next.next)==null?void 0:_ele$next$next.next}return _context.abrupt("return",{nextEl:nextEl,prev:prev});case 6:case"end":return _context.stop()}}}),_callee)})));return _getAdjacentEl.apply(this,arguments)}if(!chartAttr.allowtaskbaroverlap){getAdjacentEl().then((function(x){data.nextElement=x.nextEl;data.prevElement=x.prev;dataset._dragMove.call(ele,dx,dy,px,py,x.nextEl,x.prev)}))}else{dataset._dragMove.call(ele,dx,dy,px,py)}};_proto._dragMove=function _dragMove(dxVal,dyVal,px,py,nextEl,prevEl){var _dataSource$tasks$4,_dataSource$tasks4,_tasksMap$nextEleInde,_tasksMap$prevEleInde,_dataObj$graphics,_dataObj$graphics2,_dataObj$config2,_dataSource$connector2;var element=this,dx=dxVal,i,canvasPadding=CANVASLEFTPADDING,data=element.data("drag-options"),dataObj=data.dataObj,dataset=data.dataset,datasetConfig=dataset.config,dataSource=dataset.getFromEnv("dataSource"),task=Array.isArray(dataSource==null?void 0:dataSource.tasks)?dataSource==null?void 0:(_dataSource$tasks$4=dataSource.tasks[0])==null?void 0:_dataSource$tasks$4.task:dataSource==null?void 0:(_dataSource$tasks4=dataSource.tasks)==null?void 0:_dataSource$tasks4.task,config=dataObj.config,id=config.id,index=config==null?void 0:config.index,taskObj=task[index],chartAttr=dataSource.chart,chart=dataset.getFromEnv("chart"),numberFormatter=dataset.getFromEnv("number-formatter"),yAxis=dataset.getFromEnv("yAxis"),xAxis=dataset.getFromEnv("xAxis"),processMap=xAxis.config.processes.processMap,dataStore=dataset.components.data,ele=dataObj.graphics.element,label=(0,_lib.getFirstValue)((0,_lib.pluck)(taskObj.label,taskObj.name),BLANK),percentComplete=Math.min((0,_lib.pluckNumber)(taskObj.percentcomplete,-1),100),tasksMap=chart.components.tasksMap,dragStart=config.dragStart,dragData=config.dragData,startX=dragStart.bBox.x+dx,endX=dragStart.bBox.x2+dx,chartConfig=dataset.getFromEnv("chartConfig"),canvasLeft=chartConfig.canvasLeft,toolText="",processName,canvasRight=yAxis.getPixel(chartConfig.scrollOptions.viewPortMax),dInt=chartConfig.dateintooltip,len,viewPortScale,setObj;var dateFormat,nextElObj=task[index+1],prevElObj=task[index-1],currentObj=task[index],nextEleIndex=""+(nextElObj==null?void 0:nextElObj.id),prevEleIndex=""+(prevElObj==null?void 0:prevElObj.id),currentEleIndex=""+(currentObj==null?void 0:currentObj.id),nextElConfig=(_tasksMap$nextEleInde=tasksMap[nextEleIndex])==null?void 0:_tasksMap$nextEleInde.config,prevElConfig=(_tasksMap$prevEleInde=tasksMap[prevEleIndex])==null?void 0:_tasksMap$prevEleInde.config,delayTaskBarCheck=(nextElObj==null?void 0:nextElObj.processid)===(taskObj==null?void 0:taskObj.processid)&&(nextElObj==null?void 0:nextElObj.label)==="Delay"||(prevElObj==null?void 0:prevElObj.processId)===(taskObj==null?void 0:taskObj.processid)&&(prevElObj==null?void 0:prevElObj.label)==="Delay"||(taskObj==null?void 0:taskObj.label)==="Delay",isCurrentElementDelayTaskbar=(taskObj==null?void 0:taskObj.label)==="Delay",updatedStartX;if(chartConfig.scrolltodate){viewPortScale=chartConfig.viewPortConfig.scaleX*chartConfig.viewPortConfig.x;canvasLeft=canvasLeft+viewPortScale;canvasRight=canvasRight+viewPortScale}if(isCurrentElementDelayTaskbar){var _tasksMap$currentEleI;var currentElementWidth=(_tasksMap$currentEleI=tasksMap[currentEleIndex])==null?void 0:_tasksMap$currentEleI.config.width;updatedStartX=startX-(prevElConfig.width-currentElementWidth);if(updatedStartX<canvasLeft){dx+=canvasLeft+canvasPadding-updatedStartX}}else if(startX<canvasLeft){dx+=canvasLeft+canvasPadding-startX}if(endX>canvasRight){dx-=endX-canvasRight}if(dx){ele.data("fire_click_event",0)}if(taskObj){toolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(taskObj.tooltext,datasetConfig.hovertext,datasetConfig.plottooltext,chartAttr.plottooltext),false));if(toolText!==UNDEF){if(id&&processMap[id]){processName=processMap[id].catObj.label||processMap[id].catObj.name}toolText=(0,_lib.parseTooltext)(toolText,[3,28,29,30,31],{end:numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.outputdateformat),start:numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.outputdateformat),label:label,percentComplete:percentComplete!==-1?numberFormatter.percentValue(percentComplete):BLANK,processName:processName},dataset.config)}else{toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.outputdateformat)+" - "+numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.outputdateformat):BLANK)}}dateFormat=checkDateFormat(taskObj.start);dragStart.lastDx=dx;dataObj.config.startMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx);if(dragData.updatedStartDate!==numberFormatter.getFormattedDate(dataObj.config.startMs,dateFormat?"dd/mm/yyyy hh:mn:ss":chartAttr.dateformat)){var dragDataCopy=JSON.parse(JSON.stringify(dragData));chart.fireChartInstanceEvent(DATAPLOTDRAGMOVE,dragDataCopy)}dataObj.config.endMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+dataObj.config.width);var nextElTaskFillCheck=dataObj!=null&&(_dataObj$graphics=dataObj.graphics)!=null&&_dataObj$graphics.taskFill?(dataObj==null?void 0:(_dataObj$graphics2=dataObj.graphics)==null?void 0:_dataObj$graphics2.taskFill.id)===nextEl.id:false;if(!delayTaskBarCheck&&Math.sign(dxVal)===1&&!nextElTaskFillCheck&&nextEl&&element.attrs.x+element.attrs.width>=nextEl.attrs.x&&nextEl.attrs.y===element.attrs.y){dataObj.config.startMs=yAxis.getDraggedValue(nextEl.attrs.x-dataObj.config.width);dataObj.config.endMs=yAxis.getDraggedValue(nextEl.attrs.x)}else if(!delayTaskBarCheck&&Math.sign(dxVal)===-1&&prevEl&&prevEl.attrs.x+prevEl.attrs.width>=element.attrs.x&&(data==null?void 0:data.prevElement.attrs.y)===element.attrs.y){dataObj.config.startMs=yAxis.getDraggedValue(prevEl.attrs.x+prevEl.attrs.width);dataObj.config.endMs=yAxis.getDraggedValue(prevEl.attrs.x+prevEl.attrs.width+dataObj.config.width)}else if(delayTaskBarCheck){if(taskObj.label!=="Delay"&&nextElObj&&nextElConfig){nextElConfig.startMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+dataObj.config.width-tasksMap[""+nextElObj.id].graphics.element.attrs.width);nextElConfig.endMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+dataObj.config.width);dataset.parsePlotAttributes(tasksMap[""+nextElObj.id],i+1)}else if(taskObj.label==="Delay"&&prevElObj&&prevElConfig){prevElConfig.startMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+dataObj.config.width-tasksMap[""+prevElObj.id].graphics.element.attrs.width);prevElConfig.endMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+dataObj.config.width);dataset.parsePlotAttributes(tasksMap[""+prevElObj.id],i-1)}}dataObj.config.toolText=toolText;dragData.updatedStartDate=numberFormatter.getFormattedDate(dataObj.config.startMs,dateFormat?"dd/mm/yyyy hh:mn:ss":chartAttr.dateformat);dragData.updatedEndDate=numberFormatter.getFormattedDate(dataObj.config.endMs,dateFormat?"dd/mm/yyyy hh:mn:ss":chartAttr.dateformat);dragData.index=dataObj==null?void 0:(_dataObj$config2=dataObj.config)==null?void 0:_dataObj$config2.index;dragData.id=dataObj==null?void 0:dataObj.config.taskId;if((taskObj==null?void 0:taskObj.showasgroup)==="1"){var _firstChildTask$confi,_secondChildTask$conf;var firstChildTask=tasksMap[taskObj.processid+"-a"],secondChildTask=tasksMap[taskObj.processid+"-b"];if((firstChildTask==null?void 0:(_firstChildTask$confi=firstChildTask.config)==null?void 0:_firstChildTask$confi.endMs)<(secondChildTask==null?void 0:(_secondChildTask$conf=secondChildTask.config)==null?void 0:_secondChildTask$conf.endMs)){var newEndMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+(firstChildTask==null?void 0:firstChildTask.config.width)),updatedEndDateForChildTask=numberFormatter.getFormattedDate(newEndMs,chartAttr.dateformat),newSecondStartMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+(dataObj.config.width-(secondChildTask==null?void 0:secondChildTask.config.width))),updatedStartDateForChildTask=numberFormatter.getFormattedDate(newSecondStartMs,chartAttr.dateformat);if(secondChildTask.config.startMs>=firstChildTask.config.startMs){if(firstChildTask){firstChildTask.config._startDate=dragData.updatedStartDate;firstChildTask.config.startMs=dataObj.config.startMs;firstChildTask.config._endDate=updatedEndDateForChildTask;firstChildTask.config.endMs=newEndMs;dataset.parsePlotAttributes(firstChildTask,i+1);firstChildTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,firstChildTask.config.startMs,firstChildTask.config.endMs,firstChildTask.config)}if(secondChildTask){secondChildTask.config._startDate=updatedStartDateForChildTask;secondChildTask.config.startMs=newSecondStartMs;secondChildTask.config._endDate=dragData.updatedEndDate;secondChildTask.config.endMs=dataObj.config.endMs;dataset.parsePlotAttributes(secondChildTask,i+2);secondChildTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,secondChildTask.config.startMs,secondChildTask.config.endMs,secondChildTask.config)}}else{if(secondChildTask){secondChildTask.config._startDate=updatedStartDateForChildTask;secondChildTask.config.startMs=newSecondStartMs;secondChildTask.config._endDate=dragData.updatedEndDate;secondChildTask.config.endMs=dataObj.config.endMs;dataset.parsePlotAttributes(secondChildTask,i+2);secondChildTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,secondChildTask.config.startMs,secondChildTask.config.endMs,secondChildTask.config)}}}else{var _secondChildTask$conf2,_firstChildTask$confi2;var _newEndMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+(secondChildTask==null?void 0:secondChildTask.config.width)),_updatedEndDateForChildTask=numberFormatter.getFormattedDate(_newEndMs,chartAttr.dateformat),_newSecondStartMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+(dataObj.config.width-(firstChildTask==null?void 0:firstChildTask.config.width))),_updatedStartDateForChildTask=numberFormatter.getFormattedDate(_newSecondStartMs,chartAttr.dateformat);if((secondChildTask==null?void 0:(_secondChildTask$conf2=secondChildTask.config)==null?void 0:_secondChildTask$conf2.startMs)<(firstChildTask==null?void 0:(_firstChildTask$confi2=firstChildTask.config)==null?void 0:_firstChildTask$confi2.startMs)){if(firstChildTask){firstChildTask.config._startDate=_updatedStartDateForChildTask;firstChildTask.config.startMs=_newSecondStartMs;firstChildTask.config._endDate=dragData.updatedEndDate;firstChildTask.config.endMs=dataObj.config.endMs;dataset.parsePlotAttributes(firstChildTask,i+1);firstChildTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,firstChildTask.config.startMs,firstChildTask.config.endMs,firstChildTask.config)}if(secondChildTask){secondChildTask.config._startDate=dragData.updatedStartDate;secondChildTask.config.startMs=dataObj.config.startMs;secondChildTask.config._endDate=_updatedEndDateForChildTask;secondChildTask.config.endMs=_newEndMs;dataset.parsePlotAttributes(secondChildTask,i+2);secondChildTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,secondChildTask.config.startMs,secondChildTask.config.endMs,secondChildTask.config)}}else{if(firstChildTask){firstChildTask.config._startDate=_updatedStartDateForChildTask;firstChildTask.config.startMs=_newSecondStartMs;firstChildTask.config._endDate=dragData.updatedEndDate;firstChildTask.config.endMs=dataObj.config.endMs;dataset.parsePlotAttributes(firstChildTask,i+1);firstChildTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,firstChildTask.config.startMs,firstChildTask.config.endMs,firstChildTask.config)}}}}if((taskObj==null?void 0:taskObj.showasgroup)==="0"){if(taskObj.processid.includes(".1")){var matchingParentTask=dataset.components.data.find((function(t){return t.config.processId+".1"===taskObj.processid})),_firstChildTask4=tasksMap[matchingParentTask.config.processId+"-a"],_secondChildTask4=tasksMap[matchingParentTask.config.processId+"-b"],secondChildTaskEndMs=_secondChildTask4.config.endMs,secondChildTaskStartMs=_secondChildTask4.config.startMs;if(!secondChildTaskEndMs){secondChildTaskEndMs=yAxis.getDraggedValue(_secondChildTask4.config.dragStart.xPos+_secondChildTask4.config.dragStart.lastDx+(_secondChildTask4==null?void 0:_secondChildTask4.config.width))}if(!secondChildTaskStartMs){secondChildTaskStartMs=yAxis.getDraggedValue(_secondChildTask4.config.dragStart.xPos+_secondChildTask4.config.dragStart.lastDx)}if(secondChildTaskStartMs<_firstChildTask4.config.startMs){matchingParentTask.config._startDate=_secondChildTask4.config._startDate;matchingParentTask.config.startMs=secondChildTaskStartMs}else{matchingParentTask.config._startDate=dragData.updatedStartDate;matchingParentTask.config.startMs=dataObj.config.startMs}if(secondChildTaskEndMs<_firstChildTask4.config.endMs){matchingParentTask.config._endDate=dragData.updatedEndDate;matchingParentTask.config.endMs=dataObj.config.endMs}else{matchingParentTask.config._endDate=_secondChildTask4.config._endDate;matchingParentTask.config.endMs=secondChildTaskEndMs}matchingParentTask.config.toolText=dataset._getParentToolTextOnDrag.call(element,matchingParentTask.config.startMs,matchingParentTask.config.endMs,matchingParentTask.config);dataset.parsePlotAttributes(matchingParentTask,i-1)}if(taskObj.processid.includes(".2")){var _matchingParentTask4=dataset.components.data.find((function(t){return t.config.processId+".2"===taskObj.processid})),_firstChildTask5=tasksMap[_matchingParentTask4.config.processId+"-a"],_secondChildTask5=tasksMap[_matchingParentTask4.config.processId+"-b"],firstChildTaskEndMs=_firstChildTask5.config.endMs,firstChildTaskStartMs=_firstChildTask5.config.startMs;if(!firstChildTaskEndMs){firstChildTaskEndMs=yAxis.getDraggedValue(_firstChildTask5.config.dragStart.xPos+_firstChildTask5.config.dragStart.lastDx+(_firstChildTask5==null?void 0:_firstChildTask5.config.width))}if(!firstChildTaskStartMs){firstChildTaskStartMs=yAxis.getDraggedValue(_firstChildTask5.config.dragStart.xPos+_firstChildTask5.config.dragStart.lastDx)}if(_secondChildTask5.config.endMs<firstChildTaskEndMs){_matchingParentTask4.config._endDate=_firstChildTask5.config._endDate;_matchingParentTask4.config.endMs=firstChildTaskEndMs}else{_matchingParentTask4.config._endDate=dragData.updatedEndDate;_matchingParentTask4.config.endMs=dataObj.config.endMs}if(_secondChildTask5.config.startMs<firstChildTaskStartMs){_matchingParentTask4.config._startDate=dragData.updatedStartDate;_matchingParentTask4.config.startMs=dataObj.config.startMs}else{_matchingParentTask4.config._startDate=_firstChildTask5.config._startDate;_matchingParentTask4.config.startMs=firstChildTaskStartMs}_matchingParentTask4.config.toolText=dataset._getParentToolTextOnDrag.call(element,_matchingParentTask4.config.startMs,_matchingParentTask4.config.endMs,_matchingParentTask4.config);dataset.parsePlotAttributes(_matchingParentTask4,i-2)}}for(i=0,len=dataStore.length;i<len;i++){setObj=dataStore[i];if(dataObj.config.index===setObj.config.index){break}}if(((_dataSource$connector2=dataSource.connectors)==null?void 0:_dataSource$connector2.length)>0){task[index]=_objectSpread(_objectSpread({},task[index]),{},{start:numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.dateformat),end:numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.dateformat)});dataSource.tasks=[_objectSpread(_objectSpread({},dataSource.tasks[0]),{},{task:task})];if(dataset._linkedParent.getChildren().connector){dataset._linkedParent.getChildren().connector[0]._state.dragged=true;dataset._linkedParent.getChildren().connector[0].draw()}}dataset.parsePlotAttributes(dataObj,i);dataset&&dataset.draw();if(dataset._linkedParent.getChildren().connector){dataset._linkedParent.getChildren().connector[0]._state.dragged=false}dataset.taskHoverHandler.call(element,chart)};_proto.dragUp=function dragUp(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset;dataset._dragUp.call(ele,event)};_proto._dragUp=function _dragUp(event){var _dataSource$datatable,_dataSource$tasks$5,_dataSource$tasks5;var element=this,data=element.data("drag-options"),dataObj=data.dataObj,dataset=data.dataset,dataSource=dataset.getFromEnv("dataSource"),dataColumn=dataSource==null?void 0:(_dataSource$datatable=dataSource.datatable)==null?void 0:_dataSource$datatable.datacolumn,config=dataObj.config,id=config.id,index=config==null?void 0:config.index,direction=data.direction,numberFormatter=dataset.getFromEnv("number-formatter"),task=Array.isArray(dataSource==null?void 0:dataSource.tasks)?dataSource==null?void 0:(_dataSource$tasks$5=dataSource.tasks[0])==null?void 0:_dataSource$tasks$5.task:dataSource==null?void 0:(_dataSource$tasks5=dataSource.tasks)==null?void 0:_dataSource$tasks5.task,taskObj=task[index],chartAttr=dataSource.chart,chart=dataset.getFromEnv("chart"),tasksMap=chart.components.tasksMap;if(chartAttr.autoupdatestartenddatecolumn&&taskObj.label==="Actual"&&(dataColumn==null?void 0:dataColumn.length)>0){var _tasksMap$nextEleInde2;var actualDateIndex=Number(id)-1,nextElObj=task[index+1],nextEleIndex=""+(nextElObj==null?void 0:nextElObj.id),nextElConfig=(_tasksMap$nextEleInde2=tasksMap[nextEleIndex])==null?void 0:_tasksMap$nextEleInde2.config,delayTaskBarCheck=(nextElObj==null?void 0:nextElObj.processid)===(taskObj==null?void 0:taskObj.processid)&&(nextElObj==null?void 0:nextElObj.label)==="Delay"||(taskObj==null?void 0:taskObj.label)==="Delay";if(actualDateIndex>=0){dataSource.datatable.datacolumn[0].text[actualDateIndex].label=numberFormatter.getFormattedDate(dataObj.config.startMs,chartAttr.dateformat);dataSource.datatable.datacolumn[1].text[actualDateIndex].label=numberFormatter.getFormattedDate(dataObj.config.endMs,chartAttr.dateformat);if(delayTaskBarCheck){task[nextElConfig.index]=_objectSpread(_objectSpread({},task[nextElConfig.index]),{},{start:numberFormatter.getFormattedDate(nextElConfig.startMs,chartAttr.dateformat),end:numberFormatter.getFormattedDate(nextElConfig.endMs,chartAttr.dateformat)});dataSource.tasks=[_objectSpread(_objectSpread({},dataSource.tasks[0]),{},{task:task})]}}chart._env.chartInstance.setChartData(dataSource)}if(dataset._linkedParent.getChildren().connector){dataset._linkedParent.getChildren().connector[0]._state.dragged=true;dataset._linkedParent.getChildren().connector[0].draw()}dataset.taskHoverOutHandler.call(element,chart);if(taskObj.label==="Actual"&&direction&&direction==="left"){var _tasksMap$_nextEleInd;var _nextElObj=task[index+1],_nextEleIndex=""+(_nextElObj==null?void 0:_nextElObj.id),delayElConfig=(_tasksMap$_nextEleInd=tasksMap[_nextEleIndex])==null?void 0:_tasksMap$_nextEleInd.config;if(dataObj.config.startMs>delayElConfig.startMs){dataObj.config.startMs=delayElConfig.startMs}}else{if(data.tempStartMs)dataObj.config.startMs=data.tempStartMs;if(data.tempEndMs)dataObj.config.endMs=data.tempEndMs}};_proto.slackElemHandlers=function slackElemHandlers(slackElem,chart){var dataset=this;if(slackElem){slackElem.on("fc-click",(function(e){var ele=this;chart.plotEventHandler(ele,e)})).hover((function(data){var ele=this,dataObj=ele.data("dataObj");chart.plotEventHandler(ele,data,ROLLOVER);dataObj.config.showHoverEffect&&dataset.taskHoverHandler.call(ele,chart)}),(function(data){var ele=this,dataObj=ele.data("dataObj");chart.plotEventHandler(ele,data,ROLLOUT);dataObj.config.showHoverEffect&&dataset.taskHoverOutHandler.call(ele,chart)}))}};_proto.trimData=function trimData(datasetJSON){if(!this.config.JSONData){return}var dataSet=this,config=dataSet.config,context=config&&config.context,prevCatlen=context&&context.prevCatlen,xAxis=dataSet.getFromEnv("xAxis"),currCatLen=xAxis.getProcessLen(),catDiff=prevCatlen-currCatLen,prevData=config.JSONData,prevDataLength=prevData.task&&prevData.task.length,currDataLength=datasetJSON.task&&datasetJSON.task.length||0,dataDiff=prevDataLength-currDataLength,diff,startIndex;if(catDiff>dataDiff){diff=catDiff;startIndex=currCatLen}else{diff=dataDiff;startIndex=currDataLength}if(diff>0){this.removeData(startIndex,diff,false)}};_proto.getAxisValuePadding=function getAxisValuePadding(){return this.config.defaultPadding};_proto.drawLabel=function drawLabel(){var dataset=this,conf=dataset.config,chart=dataset.getFromEnv("chart"),animationManager=dataset.getFromEnv("animationManager"),dataStore=dataset.components.data,valElemDummy,startValElemDummy,endValElemDummy,valElem,startValElem,endValElem,config,graphics,dataObj,eventArgs,textAttr,startLabelTextAttr,endLabelTextAttr,dataLabelContainer=dataset.getContainer("dataLabelContainer"),i,len=dataStore.length;for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj.config;graphics=dataObj.graphics;eventArgs=config.eventArgs;valElemDummy=graphics.valElem;textAttr=config._labelTextAttr;if(defined(config.label)&&config.label!==BLANK&&textAttr){valElem=graphics.valElem=animationManager.setAnimation({el:valElemDummy||"text",attr:textAttr,container:dataLabelContainer,component:dataset});valElem.outlineText(conf.showTextOutline,textAttr.fill);if(!valElemDummy){valElem.data("dataset",dataset);dataset.slackElemHandlers(valElem,chart)}else{valElem.removeCSS();valElem.show()}valElem.css(config.style);valElem.data("dataObj",dataObj).data("dataObj",dataObj).data("eventArgs",eventArgs)}else{valElemDummy&&animationManager.setAnimation({el:valElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}startValElemDummy=graphics.startValElem;startLabelTextAttr=config._startLabelTextAttr;if(defined(config.startDate)&&config.startDate!==BLANK&&startLabelTextAttr){startValElem=graphics.startValElem=animationManager.setAnimation({el:startValElemDummy||"text",attr:startLabelTextAttr,container:dataLabelContainer,component:dataset});startValElem.outlineText(conf.showTextOutline,startLabelTextAttr.fill);if(!startValElemDummy){startValElem.data("dataset",dataset);dataset.slackElemHandlers(startValElem,chart)}else{startValElem.removeCSS();startValElem.show()}startValElem.css(config.style);startValElem.data("dataObj",dataObj).data("chart",chart).data("eventArgs",eventArgs)}else{startValElemDummy&&animationManager.setAnimation({el:startValElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}endValElemDummy=graphics.endValElem;endLabelTextAttr=config._endLabelTextAttr;if(defined(config.endDate)&&config.endDate!==BLANK&&endLabelTextAttr){endValElem=graphics.endValElem=animationManager.setAnimation({el:endValElemDummy||"text",attr:endLabelTextAttr,container:dataLabelContainer,component:dataset});endValElem.outlineText(conf.showTextOutline,endLabelTextAttr.fill);if(!endValElemDummy){endValElem.data("dataset",dataset);dataset.slackElemHandlers(endValElem,chart)}else{endValElem.removeCSS();endValElem.show().css(config.style)}endValElem.data("dataObj",dataObj).data("chart",chart).data("eventArgs",eventArgs)}else{endValElemDummy&&animationManager.setAnimation({el:endValElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}}};_proto.taskHoverHandler=function taskHoverHandler(){var ele=this,dataObj=ele.data("dataObj")||{},dataset=ele.data("dataset"),dataStore=dataset.components.data,config=dataObj.config||{},index=config.index,graphics=dataStore[index]&&dataStore[index].graphics,attrib={fill:config.hoverFillColor,stroke:config.hoverBorderColor};if(config.percentComplete!==-1&&!config.showAsGroup){graphics.slackElem.attr({fill:config.slackHoverColor});graphics.taskFill.attr({fill:config.hoverFillColor});delete attrib.fill}graphics.element.attr(attrib)};_proto.taskHoverOutHandler=function taskHoverOutHandler(){var ele=this,dataObj=ele.data("dataObj")||{},dataset=ele.data("dataset")||{},dataStore=dataset.components.data,config=dataObj.config||{},index=config.index,graphics=dataStore[index]&&dataStore[index].graphics,attrib={fill:config.color,stroke:config.borderColor,"stroke-width":config.borderThickness,"stroke-dasharray":config.dashedStyle};if(config.percentComplete!==-1&&!config.showAsGroup){graphics&&graphics.slackElem.attr({fill:config.slackColor});graphics&&graphics.taskFill.attr({fill:config.color});delete attrib.fill}graphics&&graphics.element.attr(attrib)};_proto.parsePlotAttributes=function parsePlotAttributes(dataObj,index){var _dataset$config,_config,_config$style,_config2,_config2$style;var dataset=this,chart=dataset.getFromEnv("chart"),jsonData=chart.getFromEnv("dataSource"),chartConfig=chart.config,canvasTop=chartConfig.canvasTop,xAxis=chart.getChildren("xAxis")[0],yAxis=chart.getChildren("yAxis")[0],config,endX,startMs,endMs,setLink,height,id,pHeight,width,width2,xPos,yPos,borderThickness,taskBarElementAttrs,crispBox,halfH,txtAlign,borderFill,padding,incrementId=index,datePadding=chartConfig.datepadding,taskHeight,labelTextAttr,endLabelTextAttr,startLabelTextAttr,proLen=jsonData.processes.process&&jsonData.processes.process.length,taskBarRadius=chartConfig.taskbarroundradius,cursor,processDimention,viewPortConfig=chartConfig.viewPortConfig,x=viewPortConfig.x,scaleX=viewPortConfig.scaleX,lineHeight;config=dataObj&&dataObj.config;!dataObj.graphics&&(dataObj.graphics={});startMs=config&&config.startMs;endMs=config&&config.endMs;if(typeof dataObj==="undefined"||typeof startMs==="undefined"||endMs===null){return}taskHeight=config.taskHeight;setLink=config.link;borderThickness=config.borderThickness;id=config.id;borderFill=config.color;lineHeight=config.lineHeight;if(incrementId>proLen-1){incrementId=0}if(typeof config.id!=="undefined"){processDimention=yAxis.getProcessPositionById(id)}else{processDimention=yAxis.getProcessPositionByIndex(incrementId)}incrementId++;pHeight=processDimention.height;padding=pHeight*(isPercent(config.topPadding)&&parseFloat(config.topPadding,10)*.01)||(0,_lib.pluckNumber)(config.topPadding,pHeight);height=config.height=pHeight*(isPercent(taskHeight)&&parseFloat(taskHeight,10)*.01)||(0,_lib.pluckNumber)(taskHeight,pHeight);xPos=config.xPos=xAxis.getPixel(config.startMs)+x*scaleX;endX=xAxis.getPixel(config.endMs)+x*scaleX;width=config.width=Math.round(width2=endX-xPos);yPos=processDimention.bottom+canvasTop-pHeight;yPos=config.yPos=yPos+Math.min(padding,pHeight-height);halfH=height*.5;crispBox=(0,_lib.crispBound)(xPos,yPos,width,height,borderThickness);xPos=crispBox.x;yPos=crispBox.y;width=crispBox.width;height=crispBox.height;if(checkInvalidValue(xPos,yPos,width,height)===false){config.inValidValue=true;return}config.props={element:{},perComElem:{},slackElem:{}};if(config.showAsGroup){taskBarElementAttrs={path:["M",xPos,yPos,"V",yPos+height,"L",xPos+halfH,yPos+halfH,"H",xPos+width-halfH,"L",xPos+width,yPos+height,"V",yPos,"H",xPos]}}else{taskBarElementAttrs={x:crispBox.x,y:crispBox.y,width:crispBox.width||1,height:height}}Object.assign(taskBarElementAttrs,{fill:borderFill,stroke:config.borderColor,cursor:setLink?"pointer":dataset!=null&&(_dataset$config=dataset.config)!=null&&_dataset$config.allowDrag?"move":BLANK,r:taskBarRadius,"stroke-width":borderThickness,width:crispBox.width||1});config.eventArgs={processId:config.processId,taskId:config.taskId,start:config._startDate,end:config._endDate,showAsGroup:config.showAsGroup,link:config.link,sourceType:"task",percentComplete:config.percentComplete!==-1,bgColor:config.rawTaskColor,bgAlpha:config.rawTaskAlpha,font:config.textFont,fontSize:config.textFontSize,fontColor:config.textColor};if(config.percentComplete!==-1&&!config.showAsGroup){width2=width*config.percentComplete*.01;borderFill=_lib.TRACKER_FILL;config.props.perComElem={attr:{x:xPos,y:yPos,height:height,width:width2,fill:config.color,cursor:setLink?"pointer":BLANK,"stroke-width":0}};config.props.slackElem={attr:{x:xPos+width2||1,y:yPos,width:width-width2,height:height,fill:config.slackColor,cursor:setLink?"pointer":BLANK,"stroke-width":0}};taskBarElementAttrs.fill=borderFill}txtAlign=config.labelAlign;labelTextAttr=config._labelTextAttr||(config._labelTextAttr={});config.props.element.attr=taskBarElementAttrs;labelTextAttr.x=xPos+width*xAlign[txtAlign]+alignGutter[txtAlign];labelTextAttr.y=yPos-parseInt(lineHeight,10)*.5-chartConfig.tasklabelspadding;labelTextAttr.text=config.label;labelTextAttr.direction=chartConfig.textDirection;labelTextAttr["text-anchor"]=align[txtAlign];labelTextAttr.cursor=cursor;labelTextAttr.fill=(0,_lib.convertColor)(config.textColor);labelTextAttr["line-height"]=lineHeight;startLabelTextAttr=config._startLabelTextAttr||(config._startLabelTextAttr={});startLabelTextAttr.x=xPos-2-datePadding;startLabelTextAttr.y=yPos+height*.5;startLabelTextAttr.text=config.startDate;startLabelTextAttr["text-anchor"]=_lib.POSITION_END;startLabelTextAttr.cursor=cursor;startLabelTextAttr.direction=chartConfig.textDirection;startLabelTextAttr.fill=(0,_lib.convertColor)(config.textColor);startLabelTextAttr["line-height"]=lineHeight;startLabelTextAttr["font-size"]=(_config=config)==null?void 0:(_config$style=_config.style)==null?void 0:_config$style.fontSize;endLabelTextAttr=config._endLabelTextAttr||(config._endLabelTextAttr={});endLabelTextAttr.x=xPos+width+2+datePadding;endLabelTextAttr.y=yPos+height*.5;endLabelTextAttr.text=config.endDate;endLabelTextAttr.cursor=cursor;endLabelTextAttr.direction=chartConfig.textDirection;endLabelTextAttr["text-anchor"]=_lib.POSITION_START;endLabelTextAttr.fill=(0,_lib.convertColor)(config.textColor);endLabelTextAttr["line-height"]=lineHeight;endLabelTextAttr["font-size"]=(_config2=config)==null?void 0:(_config2$style=_config2.style)==null?void 0:_config2$style.fontSize;config.cursor=cursor};_proto.allocatePosition=function allocatePosition(){var dataset=this,dsStore=dataset.components.data||[],length=dsStore.length,i,dataObj;for(i=0;i<length;i++){dataObj=dsStore[i];dataset.parsePlotAttributes(dataObj,i)}};_proto._removeDataVisuals=function _removeDataVisuals(dataObj){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),ele,graphics,graphicsObj;if(!dataObj){return}graphics=dataObj.graphics;for(ele in graphics){graphicsObj=graphics[ele];graphicsObj&&animationManager.setAnimation({el:graphicsObj,component:dataset})}};_proto.draw=function draw(){var _dataSource$tasks$6,_dataSource$tasks6;var dataset=this,i,visible=dataset.getState("visible"),chart=dataset.getFromEnv("chart"),toolTipController=dataset.getFromEnv("toolTipController"),chartConfig=chart.config,canvas=chart.getChildren("canvas")[0],xAxis=chart.getChildren("xAxis")[0],dataSource=dataset.getFromEnv("dataSource"),task=Array.isArray(dataSource==null?void 0:dataSource.tasks)?dataSource==null?void 0:(_dataSource$tasks$6=dataSource.tasks[0])==null?void 0:_dataSource$tasks$6.task:dataSource==null?void 0:(_dataSource$tasks6=dataSource.tasks)==null?void 0:_dataSource$tasks6.task,animationManager=dataset.getFromEnv("animationManager"),len,parentContainer=canvas.getChildContainer("taskGroup"),components=dataset.components,dataStore=components.data,dataObj,config,graphics,removeDataArr=components.removeDataArr,removeDataArrLen=removeDataArr&&removeDataArr.length,dataLabelsLayer=chart.getChildContainer("datalabelsGroup"),labelsGroup=canvas.getContainer("labelsGroup"),dataLabelContainer=dataset.getContainer("dataLabelContainer"),isContextChanged=dataset._contextChanged(),container=dataset.getContainer("taskColumnContainer"),shadowContainer=dataset.getContainer("taskColumnShadowContainer"),startMs,endMs,toolText,taskBarElement,perComElem,perComElemDummy,slackElem,slackElemDummy,elemType,taskBarElementAttrs,eventArgs,viewPortConfig=chartConfig.viewPortConfig,x=viewPortConfig.x,scaleX=viewPortConfig.scaleX,shadow=chartConfig.showshadow,dragMove=dataset.dragMove,dragStart=dataset.dragStart,dragUp=dataset.dragUp,dragMoveWidthHandler=dataset.dragMoveWidthHandler,dragStartWidthHandler=dataset.dragStartWidthHandler,conf=dataset.config;if(!dataset.getState("removed")&&!dataset.getState("dirty")&&!(isContextChanged&&visible)&&!conf.allowDrag){return}if(!container){container=dataset.addContainer("taskColumnContainer",animationManager.setAnimation({el:"group",attr:{name:"columns"},container:parentContainer,component:dataset}))}if(!visible){container.hide()}else{container.show()}if(!labelsGroup){labelsGroup=canvas.addContainer("labelsGroup",animationManager.setAnimation({el:"group",attr:{name:"task-plot-labels"},container:dataLabelsLayer,component:canvas}))}if(!dataLabelContainer){dataLabelContainer=dataset.addContainer("dataLabelContainer",animationManager.setAnimation({el:"group",attr:{name:"labels"},container:parentContainer,component:dataset}))}else{dataLabelContainer.removeCSS()}if(!visible){dataLabelContainer.hide()}else{dataLabelContainer.show()}labelsGroup=animationManager.setAnimation({el:labelsGroup,attr:{transform:"T"+-chart.config.xOffset+",0"},component:canvas});dataLabelContainer.css(conf.labelStyle);if(!shadowContainer){shadowContainer=dataset.addContainer("taskColumnShadowContainer",animationManager.setAnimation({el:"group",attr:{name:"shadow"},container:parentContainer,component:dataset}).toBack());if(!visible){shadowContainer.hide()}}len=dataStore.length;for(i=0;i<len;i++){var _config3;dataObj=dataStore[i];config=dataObj&&dataObj.config;var index=(_config3=config)==null?void 0:_config3.index,taskObj=task[index];!dataObj.graphics&&(dataObj.graphics={});graphics=dataObj.graphics;startMs=config&&config.startMs;endMs=config&&config.endMs;if(typeof dataObj==="undefined"||typeof startMs==="undefined"||endMs===null){continue}toolText=config.toolText;if(config.inValidValue){continue}taskBarElement=graphics.element;elemType=config.showAsGroup?"path":"rect";if(taskBarElement&&taskBarElement.type!==elemType){taskBarElement.remove();taskBarElement=graphics.element=null}taskBarElementAttrs=config.props.element.attr;graphics.element=animationManager.setAnimation({el:taskBarElement||elemType,label:elemType,attr:taskBarElementAttrs,container:container,component:dataset});if(!taskBarElement){taskBarElement=graphics.element;if(conf!=null&&conf.allowDrag){taskBarElement.drag(dragMove,dragStart,dragUp)}taskBarElement.data("dataset",dataset);dataset.slackElemHandlers(taskBarElement,chart)}eventArgs=config.eventArgs;var xPos=config.xPos=xAxis.getPixel(config.startMs)+x*scaleX,endX=xAxis.getPixel(config.endMs)+x*scaleX,width=config.width=Math.round(endX-xPos),widthHandlerRightEl=taskBarElement.paper.getById(dataObj.widthHandlerRightId),widthHandlerLeftEl=taskBarElement.paper.getById(dataObj.widthHandlerLeftId);if(config.percentComplete!==-1&&!config.showAsGroup){perComElemDummy=graphics.taskFill;slackElemDummy=graphics.slackElem;perComElem=graphics.taskFill=animationManager.setAnimation({el:perComElemDummy||"rect",attr:config.props.perComElem.attr,container:container,component:dataset});if(!perComElemDummy){dataset.slackElemHandlers(perComElem,chart)}slackElem=graphics.slackElem=animationManager.setAnimation({el:slackElemDummy||"rect",attr:config.props.slackElem.attr,container:container,component:dataset});container.node.insertBefore(perComElem.node,taskBarElement?taskBarElement.node:null);container.node.insertBefore(slackElem.node,taskBarElement?taskBarElement.node:null);if(!slackElemDummy){dataset.slackElemHandlers(slackElem,chart)}perComElem.show();perComElem.data("chart",chart).data("dataObj",dataObj).data("dataset",dataset);slackElem.show();perComElem&&perComElem.data("eventArgs",eventArgs);slackElem&&slackElem.data("eventArgs",eventArgs).data("dataObj",dataObj).data("dataset",dataset).data("chart",chart)}else{graphics.taskFill&&animationManager.setAnimation({el:graphics.taskFill,component:dataset,callback:hideFn,doNotRemove:true});graphics.slackElem&&animationManager.setAnimation({el:graphics.slackElem,component:dataset,callback:hideFn,doNotRemove:true})}taskBarElement.show().shadow({opacity:shadow},shadowContainer).data("dataObj",dataObj).data("chart",chart).data("dataset",dataset).data("eventArgs",eventArgs);if(conf!=null&&conf.allowDrag){taskBarElement.data("drag-options",{dataObj:dataObj,dataset:dataset,datasetIndex:dataset.index,pointIndex:dataObj.config.index,cursor:"move",chart:chart,link:dataObj.link})}if(!widthHandlerLeftEl&&conf!=null&&conf.allowDrag&&(taskObj==null?void 0:taskObj.label)!=="Delay"){var widthHandlerLeft=taskBarElement.paper.rect(taskBarElement.attrs.x-1,taskBarElement.attrs.y,2,taskBarElement.attrs.height).attr({fill:"rgb(51, 189, 218)",stroke:"none",cursor:"ew-resize",opacity:0});widthHandlerLeft.insertAfter(taskBarElement);dataObj.widthHandlerLeftId=widthHandlerLeft.id;widthHandlerLeft.drag(dragMoveWidthHandler,dragStartWidthHandler,dragUp);widthHandlerLeft.show().data("dataObj",dataObj).data("chart",chart).data("dataset",dataset).data("eventArgs",eventArgs);widthHandlerLeft.data("drag-options",{dataObj:dataObj,dataset:dataset,datasetIndex:dataset.index,pointIndex:dataObj.config.index,cursor:"ew-resize",chart:chart,link:dataObj.link,direction:"left",taskbarElement:taskBarElement});widthHandlerLeft.data("dataset",dataset)}else if(widthHandlerLeftEl&&!isNaN(taskBarElement.attrs.x)){widthHandlerLeftEl.attr("x",taskBarElement.attrs.x-1)}if(!widthHandlerRightEl&&conf!=null&&conf.allowDrag&&(taskObj==null?void 0:taskObj.label)!=="Delay"){var widthHandlerRight=taskBarElement.paper.rect(taskBarElement.attrs.x+width-1,taskBarElement.attrs.y,2,taskBarElement.attrs.height).attr({fill:"rgb(51, 189, 218)",stroke:"none",cursor:"ew-resize",opacity:0});widthHandlerRight.insertAfter(taskBarElement);dataObj.widthHandlerRightId=widthHandlerRight.id;widthHandlerRight.drag(dragMoveWidthHandler,dragStartWidthHandler,dragUp);widthHandlerRight.data("drag-options",{dataObj:dataObj,dataset:dataset,datasetIndex:dataset.index,pointIndex:dataObj.config.index,cursor:"ew-resize",chart:chart,link:dataObj.link,direction:"right",taskbarElement:taskBarElement});widthHandlerRight.data("dataset",dataset)}else if(widthHandlerRightEl&&!isNaN(taskBarElement.attrs.x)){widthHandlerRightEl.attr("x",taskBarElement.attrs.x+width-1)}toolTipController.enableToolTip(taskBarElement,toolText)}dataset.drawn?dataset.drawLabel():dataset.addJob("drawLabel",dataset.drawLabel.bind(dataset),_schedular.priorityList.label);dataset.drawn=true;for(i=0;i<removeDataArrLen;i++){dataset._removeDataVisuals(removeDataArr.shift())}};return Task}(_column.default);var _default=Task;exports.default=_default;